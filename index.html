<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
<title>ä¸€å¹´ç”Ÿã®æ¼¢å­— ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</title>

<!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼ˆUI/æœ¬æ–‡=BIZ UDPGothicã€æ•™ç§‘æ›¸ä½“ãŒç„¡ã„ç’°å¢ƒå‘ã‘ã«BIZ UDMinchoã‚‚ï¼‰ -->
<link href="https://fonts.googleapis.com/css2?family=BIZ+UDMincho:wght@400;700&family=BIZ+UDPGothic:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f7fafc; --ink:#1f2937; --muted:#6b7280; --card:#ffffff;
    --accent:#2563eb; --accent-ink:#ffffff;
    --chip:#e5e7eb; --chip-on:#dbeafe; --chip-ring:#93c5fd;
    --radius:22px; --shadow:0 10px 30px rgba(0,0,0,.08);

    /* ãƒ•ã‚©ãƒ³ãƒˆã‚¹ã‚¿ãƒƒã‚¯ */
    --ui-font-stack: "BIZ UDPGothic","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    /* æ•™ç§‘æ›¸ä½“å„ªå…ˆï¼ˆç«¯æœ«ã«ã‚ã‚‹å ´åˆã¯è‡ªå‹•é©ç”¨ï¼‰ */
    --kyokasho-stack:
      "UD Digi Kyokasho N-R",
      "UD Digi Kyokasho N-B",
      "UD ãƒ‡ã‚¸ã‚¿ãƒ« æ•™ç§‘æ›¸ä½“ N-R",
      "UD ãƒ‡ã‚¸ã‚¿ãƒ« æ•™ç§‘æ›¸ä½“ N-B",
      "Yu Kyokasho",
      "YuKyokasho",
      "YuKyokasho Yoko",
      "Hiragino KyoKashotai W3",
      "Hiragino KyoKashotai W6",
      "BIZ UDMincho",        /* Webãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆæ˜æœï¼‰ */
      "Noto Serif JP",
      "Noto Sans JP",
      system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic","Meiryo",sans-serif;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family: var(--ui-font-stack);
    display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .app{width:min(980px,96vw)}
  .panel{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:18px; display:flex; flex-direction:column; gap:14px;
  }
  .top{ display:flex; align-items:center; justify-content:center; gap:10px; }
  .btn{
    appearance:none; border:none; border-radius:14px; padding:12px 18px; font-size:16px; line-height:1; cursor:pointer;
    background:var(--chip); color:var(--ink);
    transition:background .15s ease, color .15s ease, transform .04s ease;
    font-family: var(--ui-font-stack);
  }
  .btn:active{ transform:translateY(1px) }
  .btn.primary{ background:var(--accent); color:var(--accent-ink); }
  .btn.switch.active{ background:var(--accent); color:var(--accent-ink); }
  .btn:disabled{ opacity:.5; cursor:not-allowed }
  .sep{ flex:1 }

  /* é¸æŠã‚·ãƒ¼ãƒˆ */
  .sheet{ position:fixed; inset:0; background:rgba(0,0,0,.28); display:none; align-items:flex-end; justify-content:center; }
  .sheet.show{ display:flex }
  .sheet-inner{
    width:min(980px,100%); max-height:80vh; overflow:auto;
    background:var(--card); border-radius:20px 20px 0 0; box-shadow:var(--shadow);
    padding:16px 16px 18px; display:flex; flex-direction:column; gap:12px;
  }
  .sheet-head{ display:flex; align-items:center; }
  .sheet-title{ font-weight:700; }
  .sheet-close{ margin-left:auto; background:transparent; border:none; font-size:16px; color:var(--muted); cursor:pointer; }
  .grid{ display:grid; gap:8px; grid-template-columns: repeat(10, 1fr); }
  @media (max-width:640px){ .grid{ grid-template-columns: repeat(8, 1fr); } }
  .chip{
    background:var(--chip); border:none; border-radius:12px; padding:10px 0; cursor:pointer; font-size:18px;
    font-family: var(--kyokasho-stack);
  }
  .chip.on{ background:var(--chip-on); outline:3px solid var(--chip-ring); }
  .sheet-foot{ display:flex; gap:10px; margin-top:6px; }
  .ghost{ background:transparent; border:1px solid #cbd5e1 }

  /* ã‚«ãƒ¼ãƒ‰ç”»é¢ */
  .card-wrap{ display:none; flex-direction:column; gap:10px; }
  .backlink{ background:transparent; border:none; color:var(--muted); align-self:flex-start; cursor:pointer; padding:6px 6px; }
  .card{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    padding: clamp(14px, 6vw, 28px);
    display:flex; align-items:center; justify-content:center; gap: clamp(18px, 6vw, 48px);
    min-height: 48vh;
    user-select:none;
  }
  .kanji{
    font-family: var(--kyokasho-stack);
    font-size: clamp(80px, 22vw, 220px);
    line-height:1; letter-spacing: .02em;
    font-feature-settings: "palt" 1; /* å­—é–“æ•´ãˆï¼ˆå¯¾å¿œç’°å¢ƒï¼‰ */
  }
  .answer{
    min-width: 32%;
    font-size: clamp(22px, 7vw, 42px);
    color: var(--muted);
    visibility: hidden;
    font-family: var(--ui-font-stack);
  }
  .answer.show{ visibility: visible; color: var(--ink); }

  .controls{ display:flex; align-items:center; gap:8px; }

  /* ä¸€å‘¨çµ‚äº†ã®è»½ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
  .finish{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.12); z-index:50;
  }
  .finish.show{ display:flex; animation: fade 1200ms ease; }
  .finish .box{
    background: var(--card); padding: 18px 22px; border-radius: 16px; box-shadow: var(--shadow);
    font-weight:700; font-size: 20px;
    font-family: var(--ui-font-stack);
  }
  @keyframes fade{ 0%{opacity:0} 15%{opacity:1} 85%{opacity:1} 100%{opacity:0} }
</style>
</head>
<body>
  <div class="app">
    <!-- è¨­å®šãƒ‘ãƒãƒ« -->
    <div class="panel" id="setup">
      <div class="top" aria-hidden="true" style="justify-content:center; font-weight:700;">ä¸€å¹´ç”Ÿã®æ¼¢å­— ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</div>
      <div class="controls" style="justify-content:center;">
        <button class="btn switch" id="allBtn">ãœã‚“ã¶</button>
        <button class="btn switch" id="pickBtn">ãˆã‚‰ã¶</button>
        <span class="sep"></span>
        <button class="btn primary" id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      </div>
    </div>

    <!-- ã‚«ãƒ¼ãƒ‰ç”»é¢ -->
    <div class="card-wrap" id="play">
      <button class="backlink" id="backBtn">â† ã‚‚ã©ã‚‹</button>
      <div class="card" id="card" role="button" aria-label="ã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—">
        <div class="kanji" id="q"></div>
        <div class="answer" id="a"></div>
      </div>
    </div>
  </div>

  <!-- ãˆã‚‰ã¶ã‚·ãƒ¼ãƒˆ -->
  <div class="sheet" id="sheet" aria-modal="true" role="dialog">
    <div class="sheet-inner">
      <div class="sheet-head">
        <div class="sheet-title">æ¼¢å­—ã‚’ãˆã‚‰ã¶</div>
        <button class="sheet-close" id="closeSheet">ã¨ã˜ã‚‹ âœ•</button>
      </div>
      <div class="grid" id="grid"></div>
      <div class="sheet-foot">
        <button class="btn ghost" id="clearBtn">å…¨è§£é™¤</button>
        <span class="sep"></span>
        <button class="btn primary" id="okBtn">OK</button>
      </div>
    </div>
  </div>

  <!-- ä¸€å‘¨çµ‚äº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <div class="finish" id="finish">
    <div class="box">ãŒã‚“ã°ã£ãŸã­ğŸ˜Š</div>
  </div>

<script>
/* å°1é…å½“ï¼ˆ80å­—ï¼‰ã¨ä»£è¡¨çš„ãªâ€œã‚ˆã¿â€ï¼ˆã²ã‚‰ãŒãªï¼‰ */
const KANJI_LIST = ["ä¸€","å³","é›¨","å††","ç‹","éŸ³","ä¸‹","ç«","èŠ±","è²","å­¦","æ°—","ä¹","ä¼‘","ç‰","é‡‘","ç©º","æœˆ","çŠ¬","è¦‹","äº”","å£","æ ¡","å·¦","ä¸‰","å±±","å­","å››","ç³¸","å­—","è€³","ä¸ƒ","è»Š","æ‰‹","å","å‡º","å¥³","å°","ä¸Š","æ£®","äºº","æ°´","æ­£","ç”Ÿ","é’","çŸ³","èµ¤","åƒ","å·","å…ˆ","æ—©","è‰","è¶³","æ‘","å¤§","ç”·","ç«¹","ä¸­","è™«","ç”º","å¤©","ç”°","åœŸ","äºŒ","æ—¥","å…¥","å¹´","ç™½","å…«","ç™¾","æ–‡","æœ¨","æœ¬","å","ç›®","å¤•","ç«‹","åŠ›","æ—","å…­"];

const READINGS = {
  "ä¸€":"ã„ã¡ãƒ»ã²ã¨","å³":"ã¿ã","é›¨":"ã‚ã‚","å††":"ãˆã‚“ãƒ»ã¾ã‚‹","ç‹":"ãŠã†","éŸ³":"ãŠã¨","ä¸‹":"ã—ãŸ","ç«":"ã²","èŠ±":"ã¯ãª","è²":"ã‹ã„",
  "å­¦":"ãŒããƒ»ã¾ãªã¶","æ°—":"ã","ä¹":"ãã‚…ã†ãƒ»ããƒ»ã“ã“ã®","ä¼‘":"ã‚„ã™ã‚€","ç‰":"ãŸã¾","é‡‘":"ãã‚“ãƒ»ã‹ã­","ç©º":"ãã‚‰","æœˆ":"ã¤ããƒ»ãŒã¤ãƒ»ã’ã¤",
  "çŠ¬":"ã„ã¬","è¦‹":"ã¿ã‚‹","äº”":"ã”ãƒ»ã„ã¤","å£":"ãã¡","æ ¡":"ã“ã†","å·¦":"ã²ã ã‚Š","ä¸‰":"ã•ã‚“ãƒ»ã¿","å±±":"ã‚„ã¾","å­":"ã“","å››":"ã—ãƒ»ã‚ˆã‚“ãƒ»ã‚ˆ",
  "ç³¸":"ã„ã¨","å­—":"ã˜","è€³":"ã¿ã¿","ä¸ƒ":"ã—ã¡ãƒ»ãªãª","è»Š":"ãã‚‹ã¾","æ‰‹":"ã¦","å":"ã˜ã‚…ã†ãƒ»ã¨ãŠ","å‡º":"ã§ã‚‹ãƒ»ã ã™","å¥³":"ãŠã‚“ãª","å°":"ã¡ã„ã•ã„",
  "ä¸Š":"ã†ãˆãƒ»ã‚ãŒã‚‹","æ£®":"ã‚‚ã‚Š","äºº":"ã²ã¨","æ°´":"ã¿ãš","æ­£":"ãŸã ã—ã„ãƒ»ã›ã„","ç”Ÿ":"ã„ãã‚‹ãƒ»ã†ã¾ã‚Œã‚‹ãƒ»ãªã¾","é’":"ã‚ãŠ","çŸ³":"ã„ã—","èµ¤":"ã‚ã‹","åƒ":"ã›ã‚“ãƒ»ã¡",
  "å·":"ã‹ã‚","å…ˆ":"ã•ã","æ—©":"ã¯ã‚„ã„","è‰":"ãã•","è¶³":"ã‚ã—ãƒ»ãŸã™","æ‘":"ã‚€ã‚‰","å¤§":"ãŠãŠãã„","ç”·":"ãŠã¨ã“","ç«¹":"ãŸã‘","ä¸­":"ãªã‹",
  "è™«":"ã‚€ã—","ç”º":"ã¾ã¡","å¤©":"ã¦ã‚“","ç”°":"ãŸ","åœŸ":"ã¤ã¡","äºŒ":"ã«ãƒ»ãµãŸ","æ—¥":"ã²ãƒ»ã«ã¡","å…¥":"ã„ã‚Œã‚‹ãƒ»ã¯ã„ã‚‹","å¹´":"ã¨ã—","ç™½":"ã—ã‚",
  "å…«":"ã¯ã¡ãƒ»ã‚„","ç™¾":"ã²ã‚ƒã","æ–‡":"ã¶ã‚“ãƒ»ã‚‚ã‚“ãƒ»ãµã¿","æœ¨":"ã","æœ¬":"ã»ã‚“ãƒ»ã‚‚ã¨","å":"ãª","ç›®":"ã‚","å¤•":"ã‚†ã†","ç«‹":"ãŸã¤","åŠ›":"ã¡ã‹ã‚‰","æ—":"ã¯ã‚„ã—","å…­":"ã‚ããƒ»ã‚€"
};

/* çŠ¶æ…‹ */
let picked = []; let order = []; let idx = 0; let showAns = false; let mode = null;

/* è¦ç´ å‚ç…§ */
const setup = document.getElementById('setup');
const play = document.getElementById('play');
const qEl = document.getElementById('q');
const aEl = document.getElementById('a');
const card = document.getElementById('card');

const allBtn = document.getElementById('allBtn');
const pickBtn = document.getElementById('pickBtn');
const startBtn = document.getElementById('startBtn');
const backBtn = document.getElementById('backBtn');

const sheet = document.getElementById('sheet');
const grid = document.getElementById('grid');
const okBtn = document.getElementById('okBtn');
const clearBtn = document.getElementById('clearBtn');
const closeSheet = document.getElementById('closeSheet');

const finish = document.getElementById('finish');

/* åˆæœŸ */
updateStartEnable(); setActiveButtons();

/* ãœã‚“ã¶ */
allBtn.addEventListener('click', ()=>{
  picked = [...KANJI_LIST];
  mode = 'all'; setActiveButtons(); flashPickToast(); updateStartEnable();
});

/* ãˆã‚‰ã¶ï¼ˆå¸¸ã«â€œå…¨è§£é™¤â€ã§é–‹ãï¼‰ */
pickBtn.addEventListener('click', ()=>{
  mode = 'pick'; setActiveButtons(); openPicker();
});

/* ã‚¹ã‚¿ãƒ¼ãƒˆ */
startBtn.addEventListener('click', ()=>{
  if(picked.length===0){ picked = [...KANJI_LIST]; mode='all'; setActiveButtons(); }
  begin();
});

/* ã‚‚ã©ã‚‹ */
backBtn.addEventListener('click', ()=>{ endAndReturn(); });

/* ã‚«ãƒ¼ãƒ‰ï¼šã‚¿ãƒƒãƒ—ã§ã€Œç­”ãˆâ†’æ¬¡ï¼çµ‚äº†ã€ */
card.addEventListener('click', ()=>{
  if(!showAns){ showAns = true; aEl.classList.add('show'); }
  else{
    if(idx + 1 >= order.length){ finishRound(); }
    else{ idx++; showQuestion(); }
  }
});

/* ===== é¸æŠã‚·ãƒ¼ãƒˆ ===== */
function openPicker(){
  if(!grid.dataset.ready){
    const frag = document.createDocumentFragment();
    KANJI_LIST.forEach(k=>{
      const b = document.createElement('button');
      b.className = 'chip'; b.textContent = k; b.type='button';
      b.addEventListener('click', ()=> b.classList.toggle('on'));
      frag.appendChild(b);
    });
    grid.appendChild(frag); grid.dataset.ready = '1';
  }
  Array.from(grid.children).forEach(chip=> chip.classList.remove('on')); // å…¨è§£é™¤ã§é–‹ã
  sheet.classList.add('show'); document.body.style.overflow='hidden';
}
closeSheet.addEventListener('click', closePicker);
okBtn.addEventListener('click', ()=>{
  picked = Array.from(grid.children).filter(el=>el.classList.contains('on')).map(el=>el.textContent);
  updateStartEnable(); closePicker();
});
clearBtn.addEventListener('click', ()=>{ Array.from(grid.children).forEach(el=>el.classList.remove('on')); });
function closePicker(){ sheet.classList.remove('show'); document.body.style.overflow=''; }

/* ===== å‡ºé¡Œé–‹å§‹ã¨è¡¨ç¤º ===== */
function begin(){
  order = picked.map(k => KANJI_LIST.indexOf(k)).filter(i=>i>=0);
  idx = 0; setup.style.display = 'none'; play.style.display = 'flex'; showQuestion();
}
function showQuestion(){
  const k = KANJI_LIST[order[idx]];
  qEl.textContent = k;
  aEl.textContent = READINGS[k] || "ï¼ˆã‚ˆã¿æœªè¨­å®šï¼‰";
  showAns = false; aEl.classList.remove('show');
}

/* ===== ä¸€å‘¨çµ‚äº†å‡¦ç† ===== */
function finishRound(){
  finish.classList.add('show');
  setTimeout(()=>{ finish.classList.remove('show'); endAndReturn(); }, 1200);
}
function endAndReturn(){
  play.style.display = 'none'; setup.style.display = '';
  idx = 0; showAns = false; aEl.classList.remove('show'); mode = null; setActiveButtons();
}

/* ===== è¦–è¦šçŠ¶æ…‹ ===== */
function setActiveButtons(){
  allBtn.classList.toggle('active', mode==='all');
  pickBtn.classList.toggle('active', mode==='pick');
}

/* ===== å°ã•ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ===== */
function flashPickToast(){
  allBtn.animate([{transform:'scale(1)'},{transform:'scale(1.05)'},{transform:'scale(1)'}],{duration:220});
}
function updateStartEnable(){ startBtn.disabled = false; }
</script>
</body>
</html>
